
    <!DOCTYPE html>
    <html lang="en">
    <head><meta charset="UTF-8"><title>Fireworks Show</title><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><style>*{position:relative;box-sizing:border-box;margin:0}.remove{display:none !important}.fireworks-container{height:100%;display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center}.canvas-container{width:100%;height:100%;-webkit-transition:-webkit-filter 0.3s;transition:-webkit-filter 0.3s;transition:filter 0.3s;transition:filter 0.3s, -webkit-filter 0.3s}.canvas-container canvas{position:absolute;mix-blend-mode:lighten;-webkit-transform:translateZ(0);transform:translateZ(0)}</style> <script jiny-dynamic-script="">currentLanguage="ang";text={};</script> <script jiny-common-script="">function postMessageToNative(msgJson){console.log("postMessageToNative(): "+JSON.stringify(msgJson));var encodedMsg=JSON.stringify(msgJson);postMessageToAndroid(encodedMsg);postMessageToIos(encodedMsg);} function postMessageToIos(encodedMsg){if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.iosListener) window.webkit.messageHandlers.iosListener.postMessage(encodedMsg);} function postMessageToAndroid(encodedMsg){if(window.JinyAndroid)window.JinyAndroid.postMessage(encodedMsg);} function getPageMetaData(){var container=document.querySelector(".aui-container");var containerRect=container.getBoundingClientRect();return{rect:{width:containerRect.width,height:containerRect.height},};} function toJsonObject(value){return JSON.parse(JSON.stringify(value));} function actionTaken(data,clickType,label){console.log("actionTaken(): "+JSON.stringify(data));if(clickType)data["clickType"]=clickType;if(label)data["buttonLabel"]=label;postMessageToNative({type:"action_taken",body:data});} function addTextToHTML(){const textElements=document.querySelectorAll("[text-id]");textElements.forEach((element)=>{element.innerText=getText(element.getAttribute("text-id"));});function getText(textId){if(currentLanguage==="")return"";let value=text[currentLanguage][textId]?text[currentLanguage][textId]:text["ang"][textId];return value;}} function getAttributes(element){var attributes={};if(element.hasAttributes()){for(var i=0,n=element.attributes.length;i<n;i++){var attr=element.attributes[i];attributes[attr.name]=attr.value;}} return attributes;} function changeLocale(locale){currentLanguage=locale;addTextToHTML();} window.onload=function(){postMessageToNative({type:"rendering_complete",pageMetaData:getPageMetaData(),});if(window.JinyAndroid){const selectedLanguage=window.JinyAndroid.getLocale()||"ang";currentLanguage=selectedLanguage;addTextToHTML(currentLanguage);}else if(currentLanguage!==""){addTextToHTML(currentLanguage);} var pingContainerElements=document.getElementsByClassName("ping-override");if(pingContainerElements.length>0){pingContainerElements[0].addEventListener("click",function(e){actionTaken({type:"close",close:true,optIn:true},"ping-body-click","ping-body-click");e.stopPropagation();},true);} var clickable=document.getElementsByClassName("iam-clickable");for(var i=0,n=clickable.length;i<n;i++){var el=clickable[i];var attributes=getAttributes(el);if(attributes["action-payload"]){(function(element,value,label){element.addEventListener("click",function(e){actionTaken(value,"button",label);e.stopPropagation();},true);})(el,JSON.parse(attributes["action-payload"]),attributes["action-label"]);}}};window.onresize=function(){postMessageToNative({type:"resize",pageMetaData:getPageMetaData(),});};</script> <script id="rendered-js">setTimeout(function(){console.clear();const MyMath=function(t){const e={};return e.toDeg=180/t.PI,e.toRad=t.PI/180,e.halfPI=t.PI/2,e.twoPI=2*t.PI,e.dist=((e,r)=>t.sqrt(e*e+r*r)),e.pointDist=((e,r,a,o)=>{const i=a-e,s=o-r;return t.sqrt(i*i+s*s)}),e.angle=((r,a)=>e.halfPI+t.atan2(a,r)),e.pointAngle=((r,a,o,i)=>e.halfPI+t.atan2(i-a,o-r)),e.splitVector=((e,r)=>({x:t.sin(r)*e,y:-t.cos(r)*e})),e.random=((e,r)=>t.random()*(r-e)+e),e.randomInt=((e,r)=>(t.random()*(r-e+1)|0)+e),e.randomChoice=function(e){return 1===arguments.length&&Array.isArray(e)?e[t.random()*e.length|0]:arguments[t.random()*arguments.length|0]},e.clamp=function(e,r,a){return t.min(t.max(e,r),a)},e}(Math),Ticker=function(t){const e={addListener:function(t){if("function"!=typeof t)throw"Ticker.addListener() requires a function reference passed for a callback.";o.push(t),r||(r=!0,i())}};let r=!1,a=0,o=[];function i(){t.requestAnimationFrame?requestAnimationFrame(s):webkitRequestAnimationFrame(s)}function s(e){let r=e-a;a=e,r<0?r=17:r>68&&(r=68),o.forEach(e=>e.call(t,r,r/16.6667)),i()}return e}(window),Stage=function(t,e,r){let a=0;function o(r){"string"==typeof r&&(r=e.getElementById(r)),this.canvas=r,this.ctx=r.getContext("2d"),this.canvas.style.touchAction="none",this.speed=1,this.dpr=o.disableHighDPI?1:(t.devicePixelRatio||1)/(this.ctx.backingStorePixelRatio||1),this.width=r.width,this.height=r.height,this.naturalWidth=this.width*this.dpr,this.naturalHeight=this.height*this.dpr,this.width!==this.naturalWidth&&(this.canvas.width=this.naturalWidth,this.canvas.height=this.naturalHeight,this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px"),o.stages.push(this),this._listeners={resize:[],pointerstart:[],pointermove:[],pointerend:[],lastPointerPos:{x:0,y:0}}}return o.stages=[],o.disableHighDPI=!1,o.prototype.addEventListener=function(t,e){try{"ticker"===t?r.addListener(e):this._listeners[t].push(e)}catch(t){throw"Invalid Event"}},o.prototype.dispatchEvent=function(t,e){const r=this._listeners[t];if(!r)throw"Invalid Event";r.forEach(t=>t.call(this,e))},o.prototype.resize=function(t,e){this.width=t,this.height=e,this.naturalWidth=t*this.dpr,this.naturalHeight=e*this.dpr,this.canvas.width=this.naturalWidth,this.canvas.height=this.naturalHeight,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.dispatchEvent("resize")},o.windowToCanvas=function(t,e,r){const a=t.getBoundingClientRect();return{x:(e-a.left)*(t.width/a.width),y:(r-a.top)*(t.height/a.height)}},o.mouseHandler=function(t){if(Date.now()-a<500)return;let e="start";"mousemove"===t.type?e="move":"mouseup"===t.type&&(e="end"),o.stages.forEach(r=>{const a=o.windowToCanvas(r.canvas,t.clientX,t.clientY);r.pointerEvent(e,a.x/r.dpr,a.y/r.dpr)})},o.touchHandler=function(t){a=Date.now();let e="start";"touchmove"===t.type?e="move":"touchend"===t.type&&(e="end"),o.stages.forEach(r=>{for(let a of Array.from(t.changedTouches)){let t;"end"!==e?(t=o.windowToCanvas(r.canvas,a.clientX,a.clientY),r._listeners.lastPointerPos=t,"start"===e&&r.pointerEvent("move",t.x/r.dpr,t.y/r.dpr)):t=r._listeners.lastPointerPos,r.pointerEvent(e,t.x/r.dpr,t.y/r.dpr)}})},o.prototype.pointerEvent=function(t,e,r){const a={type:t,x:e,y:r};a.onCanvas=e>=0&&e<=this.width&&r>=0&&r<=this.height,this.dispatchEvent("pointer"+t,a)},e.addEventListener("mousedown",o.mouseHandler),e.addEventListener("mousemove",o.mouseHandler),e.addEventListener("mouseup",o.mouseHandler),e.addEventListener("touchstart",o.touchHandler),e.addEventListener("touchmove",o.touchHandler),e.addEventListener("touchend",o.touchHandler),o}(window,document,Ticker),IS_MOBILE=window.innerWidth<=640,GRAVITY=.9;let stageW,stageH,simSpeed=1,quality=1;const COLOR={Red:"#ff0043",Green:"#14fc56",Blue:"#1e7fff",Purple:"#e60aff",Gold:"#ffbf36",White:"#ffffff"},INVISIBLE="_INVISIBLE_",PI_2=2*Math.PI,PI_HALF=.5*Math.PI,trailsStage=new Stage("trails-canvas"),mainStage=new Stage("main-canvas"),stages=[trailsStage,mainStage],store={_listeners:new Set,_dispatch(t){this._listeners.forEach(e=>e(this.state,t))},state:{config:{quality:"3",shell:"Crysanthemum",size:"2",autoLaunch:!0,finale:!1,skyLighting:"2",scaleFactor:.9}},setState(t){const e=this.state;this.state=Object.assign({},this.state,t),this._dispatch(e),this.persist()},subscribe(t){return this._listeners.add(t),()=>this._listeners.remove(t)}};function updateConfig(t){t=t||getConfigFromDOM(),store.setState({config:Object.assign({},store.state.config,t)}),configDidUpdate()}function configDidUpdate(){store.state.config,quality=qualitySelector(),Spark.drawWidth=.75===quality}const qualitySelector=()=>+store.state.config.quality,shellSizeSelector=()=>+store.state.config.size,finaleSelector=()=>store.state.config.finale,skyLightingSelector=()=>+store.state.config.skyLighting,scaleFactorSelector=()=>store.state.config.scaleFactor,appNodes={stageContainer:".stage-container",canvasContainer:".canvas-container"};Object.keys(appNodes).forEach(t=>{appNodes[t]=document.querySelector(appNodes[t])});const COLOR_NAMES=Object.keys(COLOR),COLOR_CODES=COLOR_NAMES.map(t=>COLOR[t]),COLOR_CODES_W_INVIS=[...COLOR_CODES,INVISIBLE],COLOR_CODE_INDEXES=COLOR_CODES_W_INVIS.reduce((t,e,r)=>(t[e]=r,t),{}),COLOR_TUPLES={};function randomColorSimple(){return COLOR_CODES[Math.random()*COLOR_CODES.length|0]}let lastColor;function randomColor(t){const e=t&&t.notSame,r=t&&t.notColor,a=t&&t.limitWhite;let o=randomColorSimple();if(a&&o===COLOR.White&&Math.random()<.6&&(o=randomColorSimple()),e)for(;o===lastColor;)o=randomColorSimple();else if(r)for(;o===r;)o=randomColorSimple();return lastColor=o,o}function whiteOrGold(){return Math.random()<.5?COLOR.Gold:COLOR.White}function makePistilColor(t){return t===COLOR.White||t===COLOR.Gold?randomColor({notColor:t}):whiteOrGold()}COLOR_CODES.forEach(t=>{COLOR_TUPLES[t]={r:parseInt(t.substr(1,2),16),g:parseInt(t.substr(3,2),16),b:parseInt(t.substr(5,2),16)}});const crysanthemumShell=(t=1)=>{const e=Math.random()<.25,r=Math.random()<.72,a=r?randomColor({limitWhite:!0}):[randomColor(),randomColor({notSame:!0})],o=r&&Math.random()<.42,i=o&&makePistilColor(a),s=r&&(Math.random()<.2||a===COLOR.White)?i||randomColor({notColor:a,limitWhite:!0}):null,n=!o&&a!==COLOR.White&&Math.random()<.42;return{shellSize:t,spreadSize:300+100*t,starLife:900+200*t,starDensity:1.2,color:a,secondColor:s,glitter:e?"light":"",glitterColor:whiteOrGold(),pistil:o,pistilColor:i,streamers:n}};function randomShell(t){return crysanthemumShell(t)}const shellTypes={Crysanthemum:crysanthemumShell};function init(){appNodes.stageContainer.classList.remove("remove"),configDidUpdate()}function fitShellPositionInBoundsH(t){return.64*t+.18}function fitShellPositionInBoundsV(t){return.75*t}function getRandomShellSize(){const t=shellSizeSelector(),e=Math.min(2.5,t),r=Math.random()*e,a=t-r,o=0===e?Math.random():1-r/e,i=Math.random()*(1-.65*o)*.5;return{size:a,x:fitShellPositionInBoundsH(Math.random()<.5?.5-i:.5+i),height:fitShellPositionInBoundsV(o)}}function seqRandomFastShell(){const t=crysanthemumShell,e=getRandomShellSize(),r=new Shell(t(e.size));r.launch(e.x,e.height);let a=r.starLife;return 900+600*Math.random()+a}function seqTwoRandom(){const t=getRandomShellSize(),e=getRandomShellSize(),r=new Shell(crysanthemumShell(t.size)),a=new Shell(crysanthemumShell(e.size)),o=.2*Math.random()-.1,i=.2*Math.random()-.1;r.launch(.3+o,t.height),setTimeout(()=>{a.launch(.7+i,e.height)},100);let s=Math.max(r.starLife,a.starLife);return(r.fallingLeaves||a.fallingLeaves)&&(s=4600),900+600*Math.random()+s}function seqTriple(){const t=crysanthemumShell,e=shellSizeSelector(),r=Math.max(0,e-1.25),a=.08*Math.random()-.04;new Shell(t(e)).launch(.5+a,.7);const o=1e3+400*Math.random(),i=1e3+400*Math.random();return setTimeout(()=>{const e=.08*Math.random()-.04;new Shell(t(r)).launch(.2+e,.1)},o),setTimeout(()=>{const e=.08*Math.random()-.04;new Shell(t(r)).launch(.8+e,.1)},i),4e3}function seqPyramid(){const t=shellSizeSelector(),e=Math.max(0,t-3),r=crysanthemumShell,a=randomShell;function o(o,i){const s=o<=.5?o/.5:(1-o)/.5;new Shell((i?a:r)(i?t:e)).launch(o,i?.75:.42*s)}let i=0,s=0;for(;i<=4;){if(4===i)setTimeout(()=>{o(.5,!0)},s);else{const t=i/4*.5,e=30*Math.random()+30;setTimeout(()=>{o(t,!1)},s),setTimeout(()=>{o(1-t,!1)},s+e)}i++,s+=200}return 4400}function seqSmallBarrage(){seqSmallBarrage.lastCalled=Date.now();const t=Math.max(0,shellSizeSelector()-2),e=crysanthemumShell,r=crysanthemumShell;function a(a,o){const i=new Shell((o?r:e)(t)),s=(Math.cos(5*a*Math.PI+PI_HALF)+1)/2;i.launch(a,.75*s)}let o=0,i=0;for(;o<5;){if(0===o)a(.5,!1),o+=1;else{const t=(o+1)/5/2,e=30*Math.random()+30,r=1===o;setTimeout(()=>{a(.5+t,r)},i),setTimeout(()=>{a(.5-t,r)},i+e),o+=2}i+=200}return 4e3}seqSmallBarrage.cooldown=15e3,seqSmallBarrage.lastCalled=Date.now();const sequences=[seqTwoRandom,seqTriple,seqPyramid,seqSmallBarrage];let isFirstSeq=!0;const finaleCount=32;let currentFinaleCount=0;function startSequence(){if(isFirstSeq)return isFirstSeq=!1,new Shell(crysanthemumShell(shellSizeSelector())).launch(.5,.5),2400;if(finaleSelector())return seqRandomFastShell(),currentFinaleCount<finaleCount?(currentFinaleCount++,170):(currentFinaleCount=0,6e3);const t=Math.random();return t<.08&&Date.now()-seqSmallBarrage.lastCalled>seqSmallBarrage.cooldown?seqSmallBarrage():t<.1?seqPyramid():t<.8?seqTwoRandom():t<1?seqTriple():void 0}let activePointerCount=0,isUpdatingSpeed=!1;function handleResize(){const t=window.innerWidth,e=window.innerHeight,r=Math.min(t,1200),a=t<=420?e:Math.min(e,1200);appNodes.stageContainer.style.width=r+"px",appNodes.stageContainer.style.height=a+"px",stages.forEach(t=>t.resize(r,a));const o=scaleFactorSelector();stageW=r/o,stageH=a/o}handleResize();let currentFrame=0,speedBarOpacity=0,autoLaunchTime=0;function updateSpeedFromEvent(t){if(isUpdatingSpeed||t.y>=mainStage.height-44){const e=16,r=(t.x-e)/(mainStage.width-2*e);return simSpeed=Math.min(Math.max(r,0),1),speedBarOpacity=1,!0}return!1}function updateGlobals(t,e){currentFrame++,isUpdatingSpeed||(speedBarOpacity-=e/30)<0&&(speedBarOpacity=0),store.state.config.autoLaunch&&(autoLaunchTime-=t)<=0&&(autoLaunchTime=1.25*startSequence())}function update(t,e){const r=t*simSpeed,a=simSpeed*e;updateGlobals(r,e);const o=1-(1-Star.airDrag)*a,i=1-(1-Star.airDragHeavy)*a,s=1-(1-Spark.airDrag)*a,n=r/1e3*GRAVITY;COLOR_CODES_W_INVIS.forEach(t=>{const e=Star.active[t];for(let t=e.length-1;t>=0;t-=1){const s=e[t];if(s.updateFrame!==currentFrame)if(s.updateFrame=currentFrame,s.life-=r,s.life<=0)e.splice(t,1),Star.returnInstance(s);else{const l=Math.pow(s.life/s.fullLife,.5),h=1-l;if(s.prevX=s.x,s.prevY=s.y,s.x+=s.speedX*a,s.y+=s.speedY*a,s.heavy?(s.speedX*=i,s.speedY*=i):(s.speedX*=o,s.speedY*=o),s.speedY+=n,s.spinRadius&&(s.spinAngle+=s.spinSpeed*a,s.x+=Math.sin(s.spinAngle)*s.spinRadius*a,s.y+=Math.cos(s.spinAngle)*s.spinRadius*a),s.sparkFreq)for(s.sparkTimer-=r;s.sparkTimer<0;)s.sparkTimer+=.75*s.sparkFreq+s.sparkFreq*h*4,Spark.add(s.x,s.y,s.sparkColor,Math.random()*PI_2,Math.random()*s.sparkSpeed*l,.8*s.sparkLife+Math.random()*s.sparkLifeVariation*s.sparkLife);s.life<s.transitionTime&&(s.secondColor&&!s.colorChanged&&(s.colorChanged=!0,s.color=s.secondColor,e.splice(t,1),Star.active[s.secondColor].push(s),s.secondColor===INVISIBLE&&(s.sparkFreq=0)),s.strobe&&(s.visible=Math.floor(s.life/s.strobeFreq)%3==0))}}const l=Spark.active[t];for(let t=l.length-1;t>=0;t-=1){const e=l[t];e.life-=r,e.life<=0?(l.splice(t,1),Spark.returnInstance(e)):(e.prevX=e.x,e.prevY=e.y,e.x+=e.speedX*a,e.y+=e.speedY*a,e.speedX*=s,e.speedY*=s,e.speedY+=n)}}),render(a)}function render(t){const{dpr:e}=mainStage,r=stageW,a=stageH,o=trailsStage.ctx,i=mainStage.ctx;colorSky(t);const s=scaleFactorSelector();for(o.scale(e*s,e*s),i.scale(e*s,e*s),o.globalCompositeOperation="source-over",o.fillStyle=`rgba(0, 0, 0, ${.175*t})`,o.fillRect(0,0,r,a),i.clearRect(0,0,r,a);BurstFlash.active.length;){const t=BurstFlash.active.pop(),e=o.createRadialGradient(t.x,t.y,0,t.x,t.y,t.radius);e.addColorStop(.024,"rgba(255, 255, 255, 1)"),e.addColorStop(.125,"rgba(255, 160, 20, 0.2)"),e.addColorStop(.32,"rgba(255, 140, 20, 0.11)"),e.addColorStop(1,"rgba(255, 120, 20, 0)"),o.fillStyle=e,o.fillRect(t.x-t.radius,t.y-t.radius,2*t.radius,2*t.radius),BurstFlash.returnInstance(t)}if(o.globalCompositeOperation="lighten",o.lineWidth=Star.drawWidth,o.lineCap="round",i.strokeStyle="#fff",i.lineWidth=1,i.beginPath(),COLOR_CODES.forEach(t=>{const e=Star.active[t];o.strokeStyle=t,o.beginPath(),e.forEach(t=>{t.visible&&(o.moveTo(t.x,t.y),o.lineTo(t.prevX,t.prevY),i.moveTo(t.x,t.y),i.lineTo(t.x-1.6*t.speedX,t.y-1.6*t.speedY))}),o.stroke()}),i.stroke(),o.lineWidth=Spark.drawWidth,o.lineCap="butt",COLOR_CODES.forEach(t=>{const e=Spark.active[t];o.strokeStyle=t,o.beginPath(),e.forEach(t=>{o.moveTo(t.x,t.y),o.lineTo(t.prevX,t.prevY)}),o.stroke()}),speedBarOpacity){const t=6;i.globalAlpha=speedBarOpacity,i.fillStyle=COLOR.Blue,i.fillRect(0,a-t,r*simSpeed,t),i.globalAlpha=1}o.setTransform(1,0,0,1,0,0),i.setTransform(1,0,0,1,0,0)}const currentSkyColor={r:0,g:0,b:0},targetSkyColor={r:0,g:0,b:0};function colorSky(t){const e=15*skyLightingSelector();let r=0;targetSkyColor.r=0,targetSkyColor.g=0,targetSkyColor.b=0,COLOR_CODES.forEach(t=>{const e=COLOR_TUPLES[t],a=Star.active[t].length;r+=a,targetSkyColor.r+=e.r*a,targetSkyColor.g+=e.g*a,targetSkyColor.b+=e.b*a});const a=Math.pow(Math.min(1,r/500),.3),o=Math.max(1,targetSkyColor.r,targetSkyColor.g,targetSkyColor.b);targetSkyColor.r=targetSkyColor.r/o*e*a,targetSkyColor.g=targetSkyColor.g/o*e*a,targetSkyColor.b=targetSkyColor.b/o*e*a,currentSkyColor.r+=(targetSkyColor.r-currentSkyColor.r)/10*t,currentSkyColor.g+=(targetSkyColor.g-currentSkyColor.g)/10*t,currentSkyColor.b+=(targetSkyColor.b-currentSkyColor.b)/10*t,appNodes.canvasContainer.style.backgroundColor=`rgb(${0|currentSkyColor.r}, ${0|currentSkyColor.g}, ${0|currentSkyColor.b})`}function createParticleArc(t,e,r,a,o){const i=e/r,s=t+e-.5*i;if(s>t)for(let e=t;e<s;e+=i)o(e+Math.random()*i*a);else for(let e=t;e>s;e+=i)o(e+Math.random()*i*a)}function createBurst(t,e,r=0,a=PI_2){const o=.5*Math.sqrt(t/Math.PI)*2*Math.PI,i=o/2;for(let t=0;t<=i;t++){const s=t/i*PI_HALF,n=Math.cos(s),l=o*n,h=l*(a/PI_2),c=PI_2/l,d=Math.random()*c+r,p=.33*c;for(let t=0;t<h;t++)e(c*t+d+Math.random()*p,n)}}mainStage.addEventListener("ticker",update);class Shell{constructor(t){if(Object.assign(this,t),this.starLifeVariation=t.starLifeVariation||.125,this.color=t.color||randomColor(),this.glitterColor=t.glitterColor||this.color,!this.starCount){const e=t.starDensity||1,r=this.spreadSize/54;this.starCount=Math.max(6,r*r*e)}}launch(t,e){const r=stageH-.45*stageH,a=t*(stageW-120)+60,o=stageH,i=o-(r-e*(r-50)),s=Math.pow(.04*i,.64),n=this.comet=Star.add(a,o,"string"==typeof this.color&&"random"!==this.color?this.color:COLOR.White,Math.PI,s*(this.horsetail?1.2:1),s*(this.horsetail?100:400));n.heavy=!0,n.spinRadius=MyMath.random(.32,.85),n.sparkFreq=8,n.sparkLife=320,n.sparkLifeVariation=3,("willow"===this.glitter||this.fallingLeaves)&&(n.sparkFreq=20/quality,n.sparkSpeed=.5,n.sparkLife=500),this.color===INVISIBLE&&(n.sparkColor=COLOR.Gold),Math.random()>.4&&!this.horsetail&&(n.secondColor=INVISIBLE,n.transitionTime=700*Math.pow(Math.random(),1.5)+500),n.onDeath=(t=>this.burst(t.x,t.y))}burst(t,e){const r=this.spreadSize/96;let a,o,i,s,n,l=.25;this.floral&&(o=floralEffect),this.fallingLeaves&&(o=fallingLeavesEffect),"light"===this.glitter?(i=400,s=.3,n=300,l=2):"medium"===this.glitter?(i=200,s=.44,n=700,l=2):"heavy"===this.glitter?(i=80,s=.8,n=1400,l=2):"thick"===this.glitter?(i=16,s=1.65,n=1400,l=3):"streamer"===this.glitter?(i=32,s=1.05,n=620,l=2):"willow"===this.glitter&&(i=120,s=.34,n=1400,l=3.8),i/=quality;const h=(h,c)=>{const d=this.spreadSize/1800,p=Star.add(t,e,a||randomColor(),h,c*r,this.starLife+Math.random()*this.starLife*this.starLifeVariation,this.horsetail?this.comet&&this.comet.speedX:0,this.horsetail?this.comet&&this.comet.speedY:-d);this.secondColor&&(p.transitionTime=this.starLife*(.05*Math.random()+.32),p.secondColor=this.secondColor),this.strobe&&(p.transitionTime=this.starLife*(.08*Math.random()+.46),p.strobe=!0,p.strobeFreq=20*Math.random()+40,this.strobeColor&&(p.secondColor=this.strobeColor)),p.onDeath=o,this.glitter&&(p.sparkFreq=i,p.sparkSpeed=s,p.sparkLife=n,p.sparkLifeVariation=l,p.sparkColor=this.glitterColor,p.sparkTimer=Math.random()*p.sparkFreq)};if("string"==typeof this.color)if(a="random"===this.color?null:this.color,this.ring){const o=Math.random()*Math.PI,h=.85*Math.pow(Math.random(),2)+.15;createParticleArc(0,PI_2,this.starCount,0,c=>{const d=Math.sin(c)*r*h,p=Math.cos(c)*r,u=MyMath.pointDist(0,0,d,p),m=MyMath.pointAngle(0,0,d,p)+o,f=Star.add(t,e,a,m,u,this.starLife+Math.random()*this.starLife*this.starLifeVariation);this.glitter&&(f.sparkFreq=i,f.sparkSpeed=s,f.sparkLife=n,f.sparkLifeVariation=l,f.sparkColor=this.glitterColor,f.sparkTimer=Math.random()*f.sparkFreq)})}else createBurst(this.starCount,h);else{if(!Array.isArray(this.color))throw new Error("Invalid shell color. Expected string or array of strings, but got: "+this.color);if(Math.random()<.5){const t=Math.random()*Math.PI,e=t+Math.PI,r=Math.PI;a=this.color[0],createBurst(this.starCount,h,t,r),a=this.color[1],createBurst(this.starCount,h,e,r)}else a=this.color[0],createBurst(this.starCount/2,h),a=this.color[1],createBurst(this.starCount/2,h)}if(this.pistil&&new Shell({spreadSize:.5*this.spreadSize,starLife:.6*this.starLife,starLifeVariation:this.starLifeVariation,starDensity:1.4,color:this.pistilColor,glitter:"light",glitterColor:this.pistilColor===COLOR.Gold?COLOR.Gold:COLOR.White}).burst(t,e),this.streamers&&new Shell({spreadSize:.9*this.spreadSize,starLife:.8*this.starLife,starLifeVariation:this.starLifeVariation,starCount:Math.floor(Math.max(6,this.spreadSize/45)),color:COLOR.White,glitter:"streamer"}).burst(t,e),BurstFlash.add(t,e,this.spreadSize/4),this.comet){const t=2;Math.min(t,shellSizeSelector()-this.shellSize)}}}const BurstFlash={active:[],_pool:[],_new:()=>({}),add(t,e,r){const a=this._pool.pop()||this._new();return a.x=t,a.y=e,a.radius=r,this.active.push(a),a},returnInstance(t){this._pool.push(t)}};function createParticleCollection(){const t={};return COLOR_CODES_W_INVIS.forEach(e=>{t[e]=[]}),t}const Star={drawWidth:3,airDrag:.98,airDragHeavy:.992,active:createParticleCollection(),_pool:[],_new:()=>({}),add(t,e,r,a,o,i,s,n){const l=this._pool.pop()||this._new();return l.visible=!0,l.heavy=!1,l.x=t,l.y=e,l.prevX=t,l.prevY=e,l.color=r,l.speedX=Math.sin(a)*o+(s||0),l.speedY=Math.cos(a)*o+(n||0),l.life=i,l.fullLife=i,l.spinAngle=Math.random()*PI_2,l.spinSpeed=.8,l.spinRadius=0,l.sparkFreq=0,l.sparkSpeed=1,l.sparkTimer=0,l.sparkColor=r,l.sparkLife=750,l.sparkLifeVariation=.25,l.strobe=!1,this.active[r].push(l),l},returnInstance(t){t.onDeath&&t.onDeath(t),t.onDeath=null,t.secondColor=null,t.transitionTime=0,t.colorChanged=!1,this._pool.push(t)}},Spark={drawWidth:0,airDrag:.9,active:createParticleCollection(),_pool:[],_new:()=>({}),add(t,e,r,a,o,i){const s=this._pool.pop()||this._new();return s.x=t,s.y=e,s.prevX=t,s.prevY=e,s.color=r,s.speedX=Math.sin(a)*o,s.speedY=Math.cos(a)*o,s.life=i,this.active[r].push(s),s},returnInstance(t){this._pool.push(t)}};appNodes.canvasContainer.style.opacity=.7,init();},100);</script><style>*{position:relative;box-sizing:border-box;margin:0}.remove{display:none!important}.fireworks-container{height:100%;display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center}.canvas-container{width:100%;height:100%;-webkit-transition:-webkit-filter .3s;transition:-webkit-filter .3s;transition:filter .3s;transition:filter .3s,-webkit-filter .3s}.canvas-container canvas{position:absolute;mix-blend-mode:lighten;-webkit-transform:translateZ(0);transform:translateZ(0)}</style></head><body><div class="fireworks-container aui-container"><div class="stage-container remove"><div class="canvas-container"> <canvas id="trails-canvas"></canvas> <canvas id="main-canvas"></canvas></div></div></div> <script>console.clear();const MyMath=(function MyMathFactory(Math){const MyMath={};MyMath.toDeg=180/Math.PI;MyMath.toRad=Math.PI/180;MyMath.halfPI=Math.PI/2;MyMath.twoPI=Math.PI*2;MyMath.dist=(width,height)=>{return Math.sqrt(width*width+height*height);};MyMath.pointDist=(x1,y1,x2,y2)=>{const distX=x2-x1;const distY=y2-y1;return Math.sqrt(distX*distX+distY*distY);};MyMath.angle=(width,height)=>MyMath.halfPI+Math.atan2(height,width);MyMath.pointAngle=(x1,y1,x2,y2)=>MyMath.halfPI+Math.atan2(y2-y1,x2-x1);MyMath.splitVector=(speed,angle)=>({x:Math.sin(angle)*speed,y:-Math.cos(angle)*speed,});MyMath.random=(min,max)=>Math.random()*(max-min)+min;MyMath.randomInt=(min,max)=>((Math.random()*(max-min+1))|0)+min;MyMath.randomChoice=function randomChoice(choices){if(arguments.length===1&&Array.isArray(choices)){return choices[(Math.random()*choices.length)|0];} return arguments[(Math.random()*arguments.length)|0];};MyMath.clamp=function clamp(num,min,max){return Math.min(Math.max(num,min),max);};return MyMath;})(Math);const Ticker=(function(t){const e={addListener:function(t){if("function"!=typeof t) throw"Ticker.addListener() requires a function reference passed for a callback.";s.push(t),i||((i=!0),h());},};let i=!1,n=0,s=[];function h(){t.requestAnimationFrame?requestAnimationFrame(a):webkitRequestAnimationFrame(a);} function a(e){let i=e-n;(n=e),i<0?(i=17):i>68&&(i=68),s.forEach((e)=>e.call(t,i,i/16.6667)),h();} return e;})(window),Stage=(function(t,e,i){let n=0;function s(i){"string"==typeof i&&(i=e.getElementById(i)),(this.canvas=i),(this.ctx=i.getContext("2d")),(this.canvas.style.touchAction="none"),(this.speed=1),(this.dpr=s.disableHighDPI?1:(t.devicePixelRatio||1)/(this.ctx.backingStorePixelRatio||1)),(this.width=i.width),(this.height=i.height),(this.naturalWidth=this.width*this.dpr),(this.naturalHeight=this.height*this.dpr),this.width!==this.naturalWidth&&((this.canvas.width=this.naturalWidth),(this.canvas.height=this.naturalHeight),(this.canvas.style.width=this.width+"px"),(this.canvas.style.height=this.height+"px")),s.stages.push(this),(this._listeners={resize:[],pointerstart:[],pointermove:[],pointerend:[],lastPointerPos:{x:0,y:0},});} return((s.stages=[]),(s.disableHighDPI=!1),(s.prototype.addEventListener=function(t,e){try{"ticker"===t?i.addListener(e):this._listeners[t].push(e);}catch(t){throw"Invalid Event";}}),(s.prototype.dispatchEvent=function(t,e){const i=this._listeners[t];if(!i)throw"Invalid Event";i.forEach((t)=>t.call(this,e));}),(s.prototype.resize=function(t,e){(this.width=t),(this.height=e),(this.naturalWidth=t*this.dpr),(this.naturalHeight=e*this.dpr),(this.canvas.width=this.naturalWidth),(this.canvas.height=this.naturalHeight),(this.canvas.style.width=t+"px"),(this.canvas.style.height=e+"px"),this.dispatchEvent("resize");}),(s.windowToCanvas=function(t,e,i){const n=t.getBoundingClientRect();return{x:(e-n.left)*(t.width/n.width),y:(i-n.top)*(t.height/n.height),};}),(s.mouseHandler=function(t){if(Date.now()-n<500)return;let e="start";"mousemove"===t.type?(e="move"):"mouseup"===t.type&&(e="end"),s.stages.forEach((i)=>{const n=s.windowToCanvas(i.canvas,t.clientX,t.clientY);i.pointerEvent(e,n.x/i.dpr,n.y/i.dpr);});}),(s.touchHandler=function(t){n=Date.now();let e="start";"touchmove"===t.type?(e="move"):"touchend"===t.type&&(e="end"),s.stages.forEach((i)=>{for(let n of Array.from(t.changedTouches)){let t;"end"!==e?((t=s.windowToCanvas(i.canvas,n.clientX,n.clientY)),(i._listeners.lastPointerPos=t),"start"===e&&i.pointerEvent("move",t.x/i.dpr,t.y/i.dpr)):(t=i._listeners.lastPointerPos),i.pointerEvent(e,t.x/i.dpr,t.y/i.dpr);}});}),(s.prototype.pointerEvent=function(t,e,i){const n={type:t,x:e,y:i};(n.onCanvas=e>=0&&e<=this.width&&i>=0&&i<=this.height),this.dispatchEvent("pointer"+t,n);}),e.addEventListener("mousedown",s.mouseHandler),e.addEventListener("mousemove",s.mouseHandler),e.addEventListener("mouseup",s.mouseHandler),e.addEventListener("touchstart",s.touchHandler),e.addEventListener("touchmove",s.touchHandler),e.addEventListener("touchend",s.touchHandler),s);})(window,document,Ticker);const IS_MOBILE=window.innerWidth<=640,GRAVITY=0.9;let stageW,stageH,simSpeed=1,quality=1;const COLOR={Red:"#ff0043",Green:"#14fc56",Blue:"#1e7fff",Purple:"#e60aff",Gold:"#ffbf36",White:"#ffffff",},INVISIBLE="_INVISIBLE_",PI_2=2*Math.PI,PI_HALF=0.5*Math.PI,trailsStage=new Stage("trails-canvas"),mainStage=new Stage("main-canvas"),stages=[trailsStage,mainStage],store={_listeners:new Set(),_dispatch(t){this._listeners.forEach((e)=>e(this.state,t));},state:{config:{quality:"3",shell:"Crysanthemum",size:"2",autoLaunch:!0,finale:!1,skyLighting:"2",scaleFactor:0.9,},},setState(t){const e=this.state;(this.state=Object.assign({},this.state,t)),this._dispatch(e),this.persist();},subscribe(t){return this._listeners.add(t),()=>this._listeners.remove(t);},};function updateConfig(t){(t=t||getConfigFromDOM()),store.setState({config:Object.assign({},store.state.config,t)}),configDidUpdate();} function configDidUpdate(){store.state.config,(quality=qualitySelector()),(Spark.drawWidth=0.75===quality);} const qualitySelector=()=>+store.state.config.quality,shellSizeSelector=()=>+store.state.config.size,finaleSelector=()=>store.state.config.finale,skyLightingSelector=()=>+store.state.config.skyLighting,scaleFactorSelector=()=>store.state.config.scaleFactor,appNodes={stageContainer:".stage-container",canvasContainer:".canvas-container",};Object.keys(appNodes).forEach((t)=>{appNodes[t]=document.querySelector(appNodes[t]);});const COLOR_NAMES=Object.keys(COLOR),COLOR_CODES=COLOR_NAMES.map((t)=>COLOR[t]),COLOR_CODES_W_INVIS=[...COLOR_CODES,INVISIBLE],COLOR_CODE_INDEXES=COLOR_CODES_W_INVIS.reduce((t,e,r)=>((t[e]=r),t),{}),COLOR_TUPLES={};function randomColorSimple(){return COLOR_CODES[(Math.random()*COLOR_CODES.length)|0];} let lastColor;function randomColor(t){const e=t&&t.notSame,r=t&&t.notColor,a=t&&t.limitWhite;let o=randomColorSimple();if((a&&o===COLOR.White&&Math.random()<0.6&&(o=randomColorSimple()),e)) for(;o===lastColor;)o=randomColorSimple();else if(r)for(;o===r;)o=randomColorSimple();return(lastColor=o),o;} function whiteOrGold(){return Math.random()<0.5?COLOR.Gold:COLOR.White;} function makePistilColor(t){return t===COLOR.White||t===COLOR.Gold?randomColor({notColor:t}):whiteOrGold();} COLOR_CODES.forEach((t)=>{COLOR_TUPLES[t]={r:parseInt(t.substr(1,2),16),g:parseInt(t.substr(3,2),16),b:parseInt(t.substr(5,2),16),};});const crysanthemumShell=(t=1)=>{const e=Math.random()<0.25,r=Math.random()<0.72,a=r?randomColor({limitWhite:!0}):[randomColor(),randomColor({notSame:!0})],o=r&&Math.random()<0.42,s=o&&makePistilColor(a),i=r&&(Math.random()<0.2||a===COLOR.White)?s||randomColor({notColor:a,limitWhite:!0}):null,n=!o&&a!==COLOR.White&&Math.random()<0.42;return{shellSize:t,spreadSize:300+100*t,starLife:900+200*t,starDensity:1.2,color:a,secondColor:i,glitter:e?"light":"",glitterColor:whiteOrGold(),pistil:o,pistilColor:s,streamers:n,};};function randomShell(t){return crysanthemumShell(t);} const shellTypes={Crysanthemum:crysanthemumShell};function init(){appNodes.stageContainer.classList.remove("remove"),configDidUpdate();} function fitShellPositionInBoundsH(t){return 0.64*t+0.18;} function fitShellPositionInBoundsV(t){return 0.75*t;} function getRandomShellSize(){const t=shellSizeSelector(),e=Math.min(2.5,t),r=Math.random()*e,a=t-r,o=0===e?Math.random():1-r/e,s=Math.random()*(1-0.65*o)*0.5;return{size:a,x:fitShellPositionInBoundsH(Math.random()<0.5?0.5-s:0.5+s),height:fitShellPositionInBoundsV(o),};} function seqRandomFastShell(){const t=crysanthemumShell,e=getRandomShellSize(),r=new Shell(t(e.size));r.launch(e.x,e.height);let a=r.starLife;return 900+600*Math.random()+a;} function seqTwoRandom(){const t=getRandomShellSize(),e=getRandomShellSize(),r=new Shell(crysanthemumShell(t.size)),a=new Shell(crysanthemumShell(e.size)),o=0.2*Math.random()-0.1,s=0.2*Math.random()-0.1;r.launch(0.3+o,t.height),setTimeout(()=>{a.launch(0.7+s,e.height);},100);let i=Math.max(r.starLife,a.starLife);return((r.fallingLeaves||a.fallingLeaves)&&(i=4600),900+600*Math.random()+i);} function seqTriple(){const t=crysanthemumShell,e=shellSizeSelector(),r=Math.max(0,e-1.25),a=0.08*Math.random()-0.04;new Shell(t(e)).launch(0.5+a,0.7);const o=1e3+400*Math.random(),s=1e3+400*Math.random();return(setTimeout(()=>{const e=0.08*Math.random()-0.04;new Shell(t(r)).launch(0.2+e,0.1);},o),setTimeout(()=>{const e=0.08*Math.random()-0.04;new Shell(t(r)).launch(0.8+e,0.1);},s),4e3);} function seqPyramid(){const t=shellSizeSelector(),e=Math.max(0,t-3),r=crysanthemumShell,a=randomShell;function o(o,s){const i=o<=0.5?o/0.5:(1-o)/0.5;new Shell((s?a:r)(s?t:e)).launch(o,s?0.75:0.42*i);} let s=0,i=0;for(;s<=4;){if(4===s) setTimeout(()=>{o(0.5,!0);},i);else{const t=(s/4)*0.5,e=30*Math.random()+30;setTimeout(()=>{o(t,!1);},i),setTimeout(()=>{o(1-t,!1);},i+e);} s++,(i+=200);} return 4400;} function seqSmallBarrage(){seqSmallBarrage.lastCalled=Date.now();const t=Math.max(0,shellSizeSelector()-2),e=crysanthemumShell,r=crysanthemumShell;function a(a,o){const s=new Shell((o?r:e)(t)),i=(Math.cos(5*a*Math.PI+PI_HALF)+1)/2;s.launch(a,0.75*i);} let o=0,s=0;for(;o<5;){if(0===o)a(0.5,!1),(o+=1);else{const t=(o+1)/5/2,e=30*Math.random()+30,r=1===o;setTimeout(()=>{a(0.5+t,r);},s),setTimeout(()=>{a(0.5-t,r);},s+e),(o+=2);} s+=200;} return 4e3;} (seqSmallBarrage.cooldown=15e3),(seqSmallBarrage.lastCalled=Date.now());const sequences=[seqTwoRandom,seqTriple,seqPyramid,seqSmallBarrage];let isFirstSeq=!0;const finaleCount=32;let currentFinaleCount=0;function startSequence(){if(isFirstSeq) return((isFirstSeq=!1),new Shell(crysanthemumShell(shellSizeSelector())).launch(0.5,0.5),2400);if(finaleSelector()) return(seqRandomFastShell(),currentFinaleCount<finaleCount?(currentFinaleCount++,170):((currentFinaleCount=0),6e3));const t=Math.random();return t<0.08&&Date.now()-seqSmallBarrage.lastCalled>seqSmallBarrage.cooldown?seqSmallBarrage():t<0.1?seqPyramid():t<0.8?seqTwoRandom():t<1?seqTriple():void 0;} let activePointerCount=0,isUpdatingSpeed=!1;function handleResize(){const t=window.innerWidth,e=window.innerHeight,r=Math.min(t,1200),a=t<=420?e:Math.min(e,1200);(appNodes.stageContainer.style.width=r+"px"),(appNodes.stageContainer.style.height=a+"px"),stages.forEach((t)=>t.resize(r,a));const o=scaleFactorSelector();(stageW=r/o),(stageH=a/o);} handleResize();let currentFrame=0,speedBarOpacity=0,autoLaunchTime=0;function updateSpeedFromEvent(t){if(isUpdatingSpeed||t.y>=mainStage.height-44){const e=16,r=(t.x-e)/(mainStage.width-2*e);return((simSpeed=Math.min(Math.max(r,0),1)),(speedBarOpacity=1),!0);} return!1;} function updateGlobals(t,e){currentFrame++,isUpdatingSpeed||((speedBarOpacity-=e/30)<0&&(speedBarOpacity=0)),store.state.config.autoLaunch&&(autoLaunchTime-=t)<=0&&(autoLaunchTime=1.25*startSequence());} function update(t,e){const r=t*simSpeed,a=simSpeed*e;updateGlobals(r,e);const o=1-(1-Star.airDrag)*a,s=1-(1-Star.airDragHeavy)*a,i=1-(1-Spark.airDrag)*a,n=(r/1e3)*GRAVITY;COLOR_CODES_W_INVIS.forEach((t)=>{const e=Star.active[t];for(let t=e.length-1;t>=0;t-=1){const i=e[t];if(i.updateFrame!==currentFrame) if(((i.updateFrame=currentFrame),(i.life-=r),i.life<=0)) e.splice(t,1),Star.returnInstance(i);else{const l=Math.pow(i.life/i.fullLife,0.5),h=1-l;if(((i.prevX=i.x),(i.prevY=i.y),(i.x+=i.speedX*a),(i.y+=i.speedY*a),i.heavy?((i.speedX*=s),(i.speedY*=s)):((i.speedX*=o),(i.speedY*=o)),(i.speedY+=n),i.spinRadius&&((i.spinAngle+=i.spinSpeed*a),(i.x+=Math.sin(i.spinAngle)*i.spinRadius*a),(i.y+=Math.cos(i.spinAngle)*i.spinRadius*a)),i.sparkFreq)) for(i.sparkTimer-=r;i.sparkTimer<0;) (i.sparkTimer+=0.75*i.sparkFreq+i.sparkFreq*h*4),Spark.add(i.x,i.y,i.sparkColor,Math.random()*PI_2,Math.random()*i.sparkSpeed*l,0.8*i.sparkLife+ Math.random()*i.sparkLifeVariation*i.sparkLife);i.life<i.transitionTime&&(i.secondColor&&!i.colorChanged&&((i.colorChanged=!0),(i.color=i.secondColor),e.splice(t,1),Star.active[i.secondColor].push(i),i.secondColor===INVISIBLE&&(i.sparkFreq=0)),i.strobe&&(i.visible=Math.floor(i.life/i.strobeFreq)%3==0));}} const l=Spark.active[t];for(let t=l.length-1;t>=0;t-=1){const e=l[t];(e.life-=r),e.life<=0?(l.splice(t,1),Spark.returnInstance(e)):((e.prevX=e.x),(e.prevY=e.y),(e.x+=e.speedX*a),(e.y+=e.speedY*a),(e.speedX*=i),(e.speedY*=i),(e.speedY+=n));}}),render(a);} function render(t){const{dpr:e}=mainStage,r=stageW,a=stageH,o=trailsStage.ctx,s=mainStage.ctx;colorSky(t);const i=scaleFactorSelector();for(o.scale(e*i,e*i),s.scale(e*i,e*i),o.globalCompositeOperation="source-over",o.fillStyle=`rgba(0,0,0,${0.175*t})`,o.fillRect(0,0,r,a),s.clearRect(0,0,r,a);BurstFlash.active.length;){const t=BurstFlash.active.pop(),e=o.createRadialGradient(t.x,t.y,0,t.x,t.y,t.radius);e.addColorStop(0.024,"rgba(255, 255, 255, 1)"),e.addColorStop(0.125,"rgba(255, 160, 20, 0.2)"),e.addColorStop(0.32,"rgba(255, 140, 20, 0.11)"),e.addColorStop(1,"rgba(255, 120, 20, 0)"),(o.fillStyle=e),o.fillRect(t.x-t.radius,t.y-t.radius,2*t.radius,2*t.radius),BurstFlash.returnInstance(t);} if(((o.globalCompositeOperation="lighten"),(o.lineWidth=Star.drawWidth),(o.lineCap="round"),(s.strokeStyle="#fff"),(s.lineWidth=1),s.beginPath(),COLOR_CODES.forEach((t)=>{const e=Star.active[t];(o.strokeStyle=t),o.beginPath(),e.forEach((t)=>{t.visible&&(o.moveTo(t.x,t.y),o.lineTo(t.prevX,t.prevY),s.moveTo(t.x,t.y),s.lineTo(t.x-1.6*t.speedX,t.y-1.6*t.speedY));}),o.stroke();}),s.stroke(),(o.lineWidth=Spark.drawWidth),(o.lineCap="butt"),COLOR_CODES.forEach((t)=>{const e=Spark.active[t];(o.strokeStyle=t),o.beginPath(),e.forEach((t)=>{o.moveTo(t.x,t.y),o.lineTo(t.prevX,t.prevY);}),o.stroke();}),speedBarOpacity)){const t=6;(s.globalAlpha=speedBarOpacity),(s.fillStyle=COLOR.Blue),s.fillRect(0,a-t,r*simSpeed,t),(s.globalAlpha=1);} o.setTransform(1,0,0,1,0,0),s.setTransform(1,0,0,1,0,0);} const currentSkyColor={r:0,g:0,b:0},targetSkyColor={r:0,g:0,b:0};function colorSky(t){const e=15*skyLightingSelector();let r=0;(targetSkyColor.r=0),(targetSkyColor.g=0),(targetSkyColor.b=0),COLOR_CODES.forEach((t)=>{const e=COLOR_TUPLES[t],a=Star.active[t].length;(r+=a),(targetSkyColor.r+=e.r*a),(targetSkyColor.g+=e.g*a),(targetSkyColor.b+=e.b*a);});const a=Math.pow(Math.min(1,r/500),0.3),o=Math.max(1,targetSkyColor.r,targetSkyColor.g,targetSkyColor.b);(targetSkyColor.r=(targetSkyColor.r/o)*e*a),(targetSkyColor.g=(targetSkyColor.g/o)*e*a),(targetSkyColor.b=(targetSkyColor.b/o)*e*a),(currentSkyColor.r+=((targetSkyColor.r-currentSkyColor.r)/10)*t),(currentSkyColor.g+=((targetSkyColor.g-currentSkyColor.g)/10)*t),(currentSkyColor.b+=((targetSkyColor.b-currentSkyColor.b)/10)*t),(appNodes.canvasContainer.style.backgroundColor=`rgb(${0|currentSkyColor.r},${0|currentSkyColor.g},${0|currentSkyColor.b})`);} function createParticleArc(t,e,r,a,o){const s=e/r,i=t+e-0.5*s;if(i>t)for(let e=t;e<i;e+=s)o(e+Math.random()*s*a);else for(let e=t;e>i;e+=s)o(e+Math.random()*s*a);} function createBurst(t,e,r=0,a=PI_2){const o=0.5*Math.sqrt(t/Math.PI)*2*Math.PI,s=o/2;for(let t=0;t<=s;t++){const i=(t/s)*PI_HALF,n=Math.cos(i),l=o*n,h=l*(a/PI_2),c=PI_2/l,d=Math.random()*c+r,p=0.33*c;for(let t=0;t<h;t++)e(c*t+d+Math.random()*p,n);}} mainStage.addEventListener("ticker",update);class Shell{constructor(t){if((Object.assign(this,t),(this.starLifeVariation=t.starLifeVariation||0.125),(this.color=t.color||randomColor()),(this.glitterColor=t.glitterColor||this.color),!this.starCount)){const e=t.starDensity||1,r=this.spreadSize/54;this.starCount=Math.max(6,r*r*e);}} launch(t,e){const r=stageH-0.45*stageH,a=t*(stageW-120)+60,o=stageH,s=o-(r-e*(r-50)),i=Math.pow(0.04*s,0.64),n=(this.comet=Star.add(a,o,"string"==typeof this.color&&"random"!==this.color?this.color:COLOR.White,Math.PI,i*(this.horsetail?1.2:1),i*(this.horsetail?100:400)));(n.heavy=!0),(n.spinRadius=MyMath.random(0.32,0.85)),(n.sparkFreq=8),(n.sparkLife=320),(n.sparkLifeVariation=3),("willow"===this.glitter||this.fallingLeaves)&&((n.sparkFreq=20/quality),(n.sparkSpeed=0.5),(n.sparkLife=500)),this.color===INVISIBLE&&(n.sparkColor=COLOR.Gold),Math.random()>0.4&&!this.horsetail&&((n.secondColor=INVISIBLE),(n.transitionTime=700*Math.pow(Math.random(),1.5)+500)),(n.onDeath=(t)=>this.burst(t.x,t.y));} burst(t,e){const r=this.spreadSize/96;let a,o,s,i,n,l=0.25;this.floral&&(o=floralEffect),this.fallingLeaves&&(o=fallingLeavesEffect),"light"===this.glitter?((s=400),(i=0.3),(n=300),(l=2)):"medium"===this.glitter?((s=200),(i=0.44),(n=700),(l=2)):"heavy"===this.glitter?((s=80),(i=0.8),(n=1400),(l=2)):"thick"===this.glitter?((s=16),(i=1.65),(n=1400),(l=3)):"streamer"===this.glitter?((s=32),(i=1.05),(n=620),(l=2)):"willow"===this.glitter&&((s=120),(i=0.34),(n=1400),(l=3.8)),(s/=quality);const h=(h,c)=>{const d=this.spreadSize/1800,p=Star.add(t,e,a||randomColor(),h,c*r,this.starLife+ Math.random()*this.starLife*this.starLifeVariation,this.horsetail?this.comet&&this.comet.speedX:0,this.horsetail?this.comet&&this.comet.speedY:-d);this.secondColor&&((p.transitionTime=this.starLife*(0.05*Math.random()+0.32)),(p.secondColor=this.secondColor)),this.strobe&&((p.transitionTime=this.starLife*(0.08*Math.random()+0.46)),(p.strobe=!0),(p.strobeFreq=20*Math.random()+40),this.strobeColor&&(p.secondColor=this.strobeColor)),(p.onDeath=o),this.glitter&&((p.sparkFreq=s),(p.sparkSpeed=i),(p.sparkLife=n),(p.sparkLifeVariation=l),(p.sparkColor=this.glitterColor),(p.sparkTimer=Math.random()*p.sparkFreq));};if("string"==typeof this.color) if(((a="random"===this.color?null:this.color),this.ring)){const o=Math.random()*Math.PI,h=0.85*Math.pow(Math.random(),2)+0.15;createParticleArc(0,PI_2,this.starCount,0,(c)=>{const d=Math.sin(c)*r*h,p=Math.cos(c)*r,S=MyMath.pointDist(0,0,d,p),u=MyMath.pointAngle(0,0,d,p)+o,m=Star.add(t,e,a,u,S,this.starLife+ Math.random()*this.starLife*this.starLifeVariation);this.glitter&&((m.sparkFreq=s),(m.sparkSpeed=i),(m.sparkLife=n),(m.sparkLifeVariation=l),(m.sparkColor=this.glitterColor),(m.sparkTimer=Math.random()*m.sparkFreq));});}else createBurst(this.starCount,h);else{if(!Array.isArray(this.color)) throw new Error("Invalid shell color. Expected string or array of strings, but got: "+ this.color);if(Math.random()<0.5){const t=Math.random()*Math.PI,e=t+Math.PI,r=Math.PI;(a=this.color[0]),createBurst(this.starCount,h,t,r),(a=this.color[1]),createBurst(this.starCount,h,e,r);}else (a=this.color[0]),createBurst(this.starCount/2,h),(a=this.color[1]),createBurst(this.starCount/2,h);} if((this.pistil&&new Shell({spreadSize:0.5*this.spreadSize,starLife:0.6*this.starLife,starLifeVariation:this.starLifeVariation,starDensity:1.4,color:this.pistilColor,glitter:"light",glitterColor:this.pistilColor===COLOR.Gold?COLOR.Gold:COLOR.White,}).burst(t,e),this.streamers&&new Shell({spreadSize:0.9*this.spreadSize,starLife:0.8*this.starLife,starLifeVariation:this.starLifeVariation,starCount:Math.floor(Math.max(6,this.spreadSize/45)),color:COLOR.White,glitter:"streamer",}).burst(t,e),BurstFlash.add(t,e,this.spreadSize/4),this.comet)){const t=2;Math.min(t,shellSizeSelector()-this.shellSize);}}} const BurstFlash={active:[],_pool:[],_new:()=>({}),add(t,e,r){const a=this._pool.pop()||this._new();return(a.x=t),(a.y=e),(a.radius=r),this.active.push(a),a;},returnInstance(t){this._pool.push(t);},};function createParticleCollection(){const t={};return(COLOR_CODES_W_INVIS.forEach((e)=>{t[e]=[];}),t);} const Star={drawWidth:3,airDrag:0.98,airDragHeavy:0.992,active:createParticleCollection(),_pool:[],_new:()=>({}),add(t,e,r,a,o,s,i,n){const l=this._pool.pop()||this._new();return((l.visible=!0),(l.heavy=!1),(l.x=t),(l.y=e),(l.prevX=t),(l.prevY=e),(l.color=r),(l.speedX=Math.sin(a)*o+(i||0)),(l.speedY=Math.cos(a)*o+(n||0)),(l.life=s),(l.fullLife=s),(l.spinAngle=Math.random()*PI_2),(l.spinSpeed=0.8),(l.spinRadius=0),(l.sparkFreq=0),(l.sparkSpeed=1),(l.sparkTimer=0),(l.sparkColor=r),(l.sparkLife=750),(l.sparkLifeVariation=0.25),(l.strobe=!1),this.active[r].push(l),l);},returnInstance(t){t.onDeath&&t.onDeath(t),(t.onDeath=null),(t.secondColor=null),(t.transitionTime=0),(t.colorChanged=!1),this._pool.push(t);},},Spark={drawWidth:0,airDrag:0.9,active:createParticleCollection(),_pool:[],_new:()=>({}),add(t,e,r,a,o,s){const i=this._pool.pop()||this._new();return((i.x=t),(i.y=e),(i.prevX=t),(i.prevY=e),(i.color=r),(i.speedX=Math.sin(a)*o),(i.speedY=Math.cos(a)*o),(i.life=s),this.active[r].push(i),i);},returnInstance(t){this._pool.push(t);},};(appNodes.canvasContainer.style.opacity=0.8),init();</script> </body>
    </html>
  
